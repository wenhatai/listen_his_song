$(document).ready(function(){
	$('.friendtitle').live('click', function(){
		if($(this).next('.list').css("display") == "block"){
			$(this).removeClass('choose').next('.list').hide(300);
		}else{
			$(this).addClass('choose').next('.list').show(300);
		}		
	});
	
	$("#addgroup input").hide();	
	$("#addgroup").click(function(){
		$(this).find("span").hide();
		$(this).find("input").show();
		$(this).find("input").focus()
	});
	
	$("#groupname").blur(function(){
		$(this).parent().find("span").show();
		$(this).hide();
	});
	
	$("#groupname").change(function(){
		$(this).hide();
		$(this).parent().find("span").show();
		var groupname = $(this).val();
		$(this).val("");
		if(groupname == ""){
			return;
		}
		$.ajax({
			url:"p/addgroup.php",
			method:"POST",
			data:{'openid':openid, 'groupname':groupname},
			success:function(data){
				$("#friendlist > ul").append("<li class='grouping'><span class='friendtitle'>"
						+groupname+"</span><ul class='list' id = '"+data+"'></ul></li>");
			},
			error:function(){
				alert("服务器忙，请稍候重试！");
			}
		});
	});
	
	$('li.grouping').contextMenu('myMenu1', {
		bindings: {
        'group_rename': function(t) {
			var groupid=t.id.substring(8);
			var oldgroup=$("#"+t.id+ " span:first").html();
			var newgroup=prompt("重命名改组名称",oldgroup);
			if(newgroup=="")
				return ;
			$.ajax({
				url:"p/renamegroup.php",
				method:"POST",
				data:{"openid":openid,"newgroup":newgroup,"groupid":groupid},
				success:function(data){
					$("#"+t.id+ " span:first").html(newgroup);
				}
			});
        },
        'group_delete': function(t) {
			var groupid=t.id.substring(8);
			if(!confirm("确定删除这一组吗？"))
				return ;
			$.ajax({
				url:"p/deletegroup.php",
				method:"POST",
				data:{"openid":openid,"groupid":groupid},
				success:function(data){
					alert(data);
					$("#"+t.id).html("");
				}
			});
        }
      }
    });
	
	$('#repeat').click(function(){
		$('.jp-toggles-list').slideDown();
	});
	
	$('.jp-toggles-list a').click(function(){
		$('.jp-toggles-list').slideUp();
		$('#repeat img').attr('src','image/'+$(this).attr('class')+'.png');
	});
	
	$('#search input').focus(function(){
		$(this).attr('value', '');
	}).blur(function(){
		if($(this).attr('value') == ''){
			$(this).attr('value', '输入你想要的音乐');
		}
	});
	
	$('.removefriend').live('click',function(){
		var selectid=$(this).parent().attr('id');
		var removeid=selectid.split("_");
		if(!confirm("确定删除?"))
			return ;
		$.ajax({
			url:"p/removefriend.php",
			method:"GET",
			data:{
				"gid":removeid[0],
				"fid":removeid[1]
			},
			success:function(data){
				$("#"+selectid).remove();
			}
		});
	});
});