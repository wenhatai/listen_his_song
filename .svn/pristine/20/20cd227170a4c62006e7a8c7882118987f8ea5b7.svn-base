$(document).ready(function() {
	var songName = "";
	var singerName = "";
	$( "#dialog" ).dialog({
		autoOpen: false,
		height: 300,
		width: 350,
		modal: true,
		bigframe: true,
		buttons: {
			"上传": function() {
				songName = $("#songName").val();
				singerName = $("#singerName").val();
				if(songName == undefined || songName == ""){
					alert("请填写歌曲名！");
					return;
				}
				if(singerName == undefined || singerName == ""){
					alert("请填写歌手名！");
					return;
				}
				$("#file_upload").uploadify("settings", "formData", {'name' : songName, 'singer' : singerName, 'openid':openid});
				$("#file_upload").uploadify('upload', '*');
			},
			"取消": function() {
				$( this ).dialog( "close" );
			}
		},
		close: function() {
			
		}
	});
	
	$("#file_upload").uploadify({
		'auto'			: false,
		'multi'			: false,
		'fileTypeDesc' : 'MP3 Files',
        'fileTypeExts' : '*.mp3', 
        'formData'      : {'name' : "test", 'singer' : "test"},
        'swf'           : 'js/uploadify.swf',
        'uploader'      : 'p/uploadify.php',
		'queueSizeLimit': '1',
		'buttonText'	: "选择一个Mp3文件",
		'onSelect' : function(file) {
			$("#songName").val(file.name.split('.')[0]);
        },
		'onUploadSuccess' : function(file, data, response) {
            alert('The file ' + file.name + ' was successfully uploaded with a response of ' + response + ':' + data);
			var ret = eval('(' + data + ')');
			myPlayerlist.add({
				title:ret.sname,
				free: true,
				mp3:ret.src,
			});
			myPlayerlist.play(-1);
        },
		'onUploadError' : function(file, errorCode, errorMsg, errorString) {
            alert('The file ' + file.name + ' could not be uploaded: ' + errorString);
        },
    });

	$( "#upload-song")
		.button()
		.click(function(){
			$( "#dialog").dialog("open");
		});
	
});