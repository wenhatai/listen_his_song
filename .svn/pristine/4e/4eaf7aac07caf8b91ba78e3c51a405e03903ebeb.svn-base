function ajaxMp3Upload()
{
	$("#loading")
	.ajaxStart(function(){
		$(this).show();
	})
	.ajaxComplete(function(){
		$(this).hide();
	});
	var songName = $("#nameOfSong").val();
	var singerName = $("#singerOfSong").val();
	$.ajaxFileUpload({
		url:'p/doajaxmp3upload.php',
		secureuri:false,
		fileElementId:'songToUpload',
		//dataType: 'json',
		data:{"name":songName, "singer":singerName},
		success: function (data){
			$("#result").append(data);
			if(typeof(data.error) != 'undefined'){
				if(data.error != ''){
					alert(data.error);
				}else{
					alert(data.msg);
				}
			}
		},
		error: function (data, status, e){
			alert(e);
		}
	});
		
	return false;
}

$(document).ready(function() {
	$( "#dialog" ).dialog({
		autoOpen: false,
		height: 300,
		width: 350,
		modal: true,
		buttons: {
			"上传": function() {
				ajaxMp3Upload();
				alert("Ok!");
				//$( this ).dialog( "close" );
			},
			"取消": function() {
				$( this ).dialog( "close" );
			}
		},
		close: function() {
			allFields.val( "" ).removeClass( "ui-state-error" );
		}
	});

	$( "#upload-song")
		.button()
		.click(function(){
			$( "#dialog").dialog("open");
		});
});