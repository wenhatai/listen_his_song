<?php
require_once("../../modules/class.song.php");
require_once("../../modules/class.user.php");
require_once("../../modules/class.listenedSong.php");

$uid = $_REQUEST['openid'];
$sid = $_REQUEST['sid'];
$song = new Song();
$ret = $song->is_myplaylist($sid, $uid);
$usid = null;
if(!$ret){
	$user = new User($uid);
	$usid = $user->listenANewSong($sid);
} else {
	$usid = $ret['usid'];
	if($ret['flag'] == 0){
		$user = new User($uid);
		$user->findSongBack($ret['usid']);
	}
}

$listenedSong = new ListenedSong();
$listenedSong->insert($usid);

echo $usid;
?>